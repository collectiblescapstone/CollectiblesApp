generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  email           String            @unique
  username        String?           @unique
  id              String            @id @db.Uuid
  bio             String?
  facebook        String?
  firstName       String?
  instagram       String?
  lastName        String?
  location        String?
  x               String?
  discord         String?
  whatsapp        String?
  profile_pic     Int               @default(0)
  visibility      String            @default("public")
  latitude        Float?
  longitude       Float?
  rating          Float             @default(0)
  rating_count    Int               @default(0)
  collection      CollectionEntry[]
  wishlist        WishlistEntry[]
}

model Set {
  id       String  @id
  name     String
  series   String
  logo     String?
  official Int     @default(0)
  symbol   String?
  total    Int     @default(0)
  cards    Card[]
}

model Card {
  id          String            @id
  name        String
  image_url   String
  category    String
  dexId       Int[]
  illustrator String?
  rarity      String
  setId       String
  variants    String[]
  types       String[]
  set         Set               @relation(fields: [setId], references: [id])
  collection  CollectionEntry[]
  wishlist    WishlistEntry[]
}

model CollectionEntry {
  id         String   @id @default(cuid())
  userId     String   @db.Uuid
  cardId     String
  condition  String?
  variant    String   @default("normal")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  forTrade   Boolean  @default(false)
  showcase   Boolean  @default(false)
  grade      String   @default("Ungraded")
  gradeLevel String?
  tags       String[] @default([])
  card       Card     @relation(fields: [cardId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@index([cardId])
  @@index([userId])
}

model WishlistEntry {
  id      String  @id @default(cuid())
  userId  String  @db.Uuid
  cardId  String
  variant String?
  card    Card    @relation(fields: [cardId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@unique([userId, cardId, variant])
}
