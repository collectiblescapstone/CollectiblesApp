// ======================================
// Prisma Schema
// ======================================

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ======================================
// Models
// ======================================

model User {
  id        String  @id @db.Uuid
  username  String? @unique
  firstName String?
  lastName  String?
  email     String  @unique
  location  String?
  instagram String?
  x         String?
  facebook  String?
  bio       String?

  collection CollectionEntry[]
  wishlist   WishlistEntry[]
}

// --------------------------------------

model Set {
  id       String  @id
  name     String
  series   String
  logo     String?
  symbol   String?
  official Int     @default(0)
  total    Int     @default(0)

  cards Card[]
}

// --------------------------------------

model Card {
  id          String
  setId       String
  name        String
  category    String
  types       String[]
  illustrator String?
  rarity      String
  variants    String[]
  dexId       Int[]
  image_url   String

  set        Set               @relation(fields: [setId], references: [id])
  collection CollectionEntry[]
  wishlist   WishlistEntry[]

  @@id([id, setId])
}

// --------------------------------------

model CollectionEntry {
  id     String @id @default(cuid())
  userId String @db.Uuid
  cardId String
  setId  String

  user User @relation(fields: [userId], references: [id])
  card Card @relation(fields: [cardId, setId], references: [id, setId])

  condition  String?
  grade      String   @default("Ungraded")
  gradeLevel String?
  variant    String?
  tags       String[] @default([])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([cardId, setId])
}

// --------------------------------------

model WishlistEntry {
  id     String @id @default(cuid())
  userId String @db.Uuid
  cardId String
  setId  String

  user User @relation(fields: [userId], references: [id])
  card Card @relation(fields: [cardId, setId], references: [id, setId])

  variant String?

  @@unique([userId, cardId, setId, variant])
  @@index([userId])
}
